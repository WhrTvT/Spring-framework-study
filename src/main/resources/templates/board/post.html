<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>게시판 - 글쓰기</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css" />
</head>
<body>
<header th:insert="~{common/header.html}"></header>
<div class="container">
    <form id="postForm" method="post">
        <div class="form-group row">
            <label for="inputTitle" class="col-sm-2 col-form-label"><strong>제목</strong></label>
            <div class="col-sm-10">
                <input type="text" name="title" class="form-control" id="inputTitle" />
            </div>
        </div>
        <div class="form-group row">
            <label for="inputAuthor" class="col-sm-2 col-form-label"><strong>작성자</strong></label>
            <div class="col-sm-10">
                <input type="text" name="author" class="form-control" id="inputAuthor" />
            </div>
        </div>
        <div class="form-group row">
            <label for="inputContent" class="col-sm-2 col-form-label"><strong>내용</strong></label>
            <div class="col-sm-10">
                <textarea type="text" name="content" class="form-control" id="inputContent"></textarea>
            </div>
        </div>
        <div class="row">
            <div class="col-auto mr-auto"></div>
            <div class="col-auto">
                <input class="btn btn-primary" type="submit" role="button" value="글쓰기" />
            </div>
        </div>
    </form>
</div>
<script src="/webjars/jquery/3.7.1/dist/jquery.min.js"></script>
<script src="/webjars/bootstrap/5.3.3/js/bootstrap.min.js"></script>
<script>
    // 폼 데이터 전송
    document.getElementById('postForm').addEventListener('submit', function (event) {
        event.preventDefault(); // 기본 폼 제출 동작 막기

        const formData = {
            title: document.getElementById('inputTitle').value,
            content: document.getElementById('inputContent').value,
            author: document.getElementById('inputAuthor').value
        };

        // REST API로 데이터 전송
        fetch('/api/board', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(`${error.status}: ${error.message}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                // if (response.ok) {
                    alert('글이 성공적으로 등록되었습니다!');
                    window.location.href = '/board'; // 글 목록 페이지로 이동
                // } else {
                //     alert('글 등록에 실패했습니다.');
                // }
            })
            .catch(error => {
                alert(`오류가 발생했습니다. 서버 응답 : ${error.message}`);
            });
    });
</script>
</body>
</html>